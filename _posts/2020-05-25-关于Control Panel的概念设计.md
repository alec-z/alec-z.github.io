---
layout: post
title: 关于Control Panel概念设计
description: "关于Control Panel概念设计"
tags: [物联网 时序数据库] 
---


## 目标 
一个开源的，强扩展性强，开箱即用的，高性能的，用户友好的通用Control Panel"监控"平台系统。"监控" = "监视"+"控制"
 
## 组件
1. 网关
  + 概述   
  网关主要作用有2个 a:监控控制对象寻址. b:协议转换。c:对接探针   
  其中协议转化又包括2方向:   
  Event: 从监控对象上报的信息的抽象成一个事件（event)，包括产生事件的源头，事件类型，事件时间，事件参数等信息。    
  Cmd: 对于从后端向监控对象发送命令抽象为指令，也抽象成一个remote call. http api调用,可以用contract（open api)描述接口，主要包括参数和返回。
  多个cmd可以组合成一个复合cmd.   
  + 关键点   
  性能, NOI, 多实例部署。
  可用性， 多实例部署，故障自动切换和恢复。
  不停机可扩充协议。
  QOS。
2. 事件和指令队列
  + 概述
  缓存事件，提供事件顺序和持久化。接受后端指令产生非原始事件（可带有定时器）。缓存，持久化指令。cmd有状态，（缓存中，发送完毕，已返回）
  + 关键点
  使用时序数据库持久化，事件和指令。
  需要在事务性，性能，可用性之间找平衡。
3. 控制器
  + 自动控制器（规则引擎）。按规则链，设计。每个规则，由一个事件触发。编程的范式如下：
  step1.事件的参数的进行运算 step2.用事件的参数+一个查询模版对时序数据库的查询。 step3 对时序数据库查询的结果进行运算。 
  通过前3步中的参数和结果生成cmd的参数，发起一次cmd的调用。
  + 手动控制器。（页面控制）。step1用户输入参数 step2时序数据库查询结果(可选) step3组合1，2生成Cmd的参数。
  + 报警器
4. 页面（前端）
  所谓控制面板，就是"监视"+"控制"。这个在真实世界有很多例子。如发电站的控制台，飞机的控制面板，汽车的导航+中央控制系统如下图：
  ![old fashion control panel](/images/control_panel/Pencil-Case-sm_700.jpeg)
  仪表是"监视机构"，按钮，旋钮，滑动条是"控制机构"。有几个设计原则
  + 对同一类，或者相关信息的"监视机构"和"控制机构"放在一起。形成一个"监控组"。
  + 不同的"监视机构"适合与展示不同种类的信息。比如如果关心温度的历史变化，应该是曲线图+当前温度比较合适。如果关心温度的变化范围，是否
  太高超过了警戒线。太低效率不高（汽车的水温表）。那么带有范围的指针式仪表比较合适，可以加上带有颜色数字方便阅读。指针可以显示当前值距离范围界限的距离。
  需要积累多种"范式",或者说组件。同样的逻辑也适合"控制机构"
  + 不同的监控组也应该按组间的相关性组织空间和逻辑的相互关系。
  + 
  "监视机构"--- "前端展示块"，对应一个事件流+一个时序数据库的查询。
  "控制机构"--- "前端控制块"，就是手动控制器,由用户设置的参数。并发起CMD调用，参数可以可以有默认值。
  展示块和控制块应该放在一起。
  
    
  
  
  
  
   
  
  
  







   
